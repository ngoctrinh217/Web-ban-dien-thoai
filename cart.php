<?php
include 'header.php';
?>

<section class="h-100" style="background-color: #eee;">
    <div class="container h-100 py-5">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-10">

                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="fw-normal mb-0 text-black">Shopping Cart</h3>
                    <div>
                        <p class="mb-0"><span class="text-muted">Sort by:</span> <a href="#!" class="text-body">price <i class="fas fa-angle-down mt-1"></i></a></p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body cart-title">
                        <div class="row d-flex justify-content-between align-items-center">
                            <div class="d-flex justify-content-center align-items-center col-md-2 col-lg-2 col-xl-2">
                                <h4>Hình ảnh</h4>
                            </div>
                            <div class="d-flex justify-content-start align-items-center col-sm-0 col-md-3 col-lg-2 col-xl-3">
                                <h4>Tên điện thoại</h4>
                            </div>
                            <div class="d-flex justify-content-center align-items-center col-sm-0 col-md-2 col-lg-2 col-xl-2">
                                <h4>Số lượng</h4>
                            </div>
                            <div class="d-flex justify-content-start align-items-center col-sm-0 col-md-2 col-lg-1 col-xl-1 offset-lg-1">
                                <h4>Giá</h4>
                            </div>
                            <div class="d-flex justify-content-start align-items-center col-sm-0 col-md-2 col-lg-2 col-xl-1 offset-lg-1">
                                <h4>Tổng giá</h4>
                            </div>
                            <div class="d-flex justify-content-end   align-items-center col-sm-0 col-md-1 col-lg-1 col-xl-1 text-end">
                                <h4>Xóa</h4>
                            </div>
                        </div>
                        <!-- Tieu de -->

                    </div>
                </div>
                <div class="cart-list-wrap">

                </div>
            </div>
        </div>
    </div>
</section>
<script>

</script>
<div class="container-fluid p-0">

    <footer class="bg-white text-center text-lg-start text-black">
        <!-- Grid container -->
        <div class="container p-4">
            <!--Grid row-->
            <div class="row my-4">
                <!--Grid column-->
                <div class="col-lg-3 col-md-6 mb-4 mb-md-0 footer_logo">

                    <div class="rounded-circle bg-white shadow-1-strong d-flex align-items-center justify-content-center mb-4 mx-auto" style="width: 150px; height: 150px;">
                        <img src="./assets/img/logovorke1231.png" height="70" alt="" loading="lazy" />
                    </div>

                    <p class="text-center footer_logo-title">Kết nối cuộc sống thông qua công nghệ với những sản
                        phẩm điện
                        thoại chất
                        lượng tại đây
                    </p>

                    <ul class="list-unstyled d-flex flex-row justify-content-center footer_logo-social">
                        <li>
                            <a class="px-2" href="#!">
                                <i class="fab fa-facebook-square"></i>
                            </a>
                        </li>
                        <li>
                            <a class="px-2" href="#!">
                                <i class="fab fa-instagram"></i>
                            </a>
                        </li>
                        <li>
                            <a class="ps-2" href="#!">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </li>
                    </ul>

                </div>
                <!--Grid column-->

                <!--Grid column-->
                <div class="col-lg-3 col-md-6 mb-4 mb-md-0 footer_phone">
                    <h5 class="text-uppercase mb-4">Điện thoại</h5>

                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none">Iphone 14 ProMax</a>
                        </li>
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none">Huawei Nova 3i</a>
                        </li>
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none">Iphone 12 Pro</a>
                        </li>
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none">Iphone 11 Pro</a>
                        </li>
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none">Iphone 13 ProMax</a>
                        </li>
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none">Iphone 12 ProMax</a>
                        </li>
                        <li class="mb-2">
                            <a href="#!" class="text-black">Xem tất cả</a>
                        </li>
                    </ul>
                </div>
                <!--Grid column-->

                <!--Grid column-->
                <div class="col-lg-3 col-md-6 mb-4 mb-md-0 member">
                    <h5 class="text-uppercase mb-4">Thành viên</h5>

                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none"><i class="fa-solid fa-user"></i>Dịp
                                Lâm Tuấn</a>
                        </li>
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none"><i class="fa-solid fa-user"></i>Nguyễn Hồng Thái</a>
                        </li>
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none"><i class="fa-solid fa-user"></i>Trần Tân Minh</a>
                        </li>
                        <li class="mb-2">
                            <a href="#!" class="text-black text-decoration-none"><i class="fa-solid fa-user"></i>Nguyễn Ngọc Trình</a>
                        </li>

                    </ul>
                </div>
                <!--Grid column-->

                <!--Grid column-->
                <div class="col-lg-3 col-md-6 mb-4 mb-md-0 contact">
                    <h5 class="text-uppercase mb-4">Liên Lạc</h5>

                    <ul class="list-unstyled">
                        <li>
                            <p><i class="fas fa-map-marker-alt pe-2"></i>Warsaw, 57 Street, Poland</p>
                        </li>
                        <li>
                            <p><i class="fas fa-phone pe-2"></i>+ 01 234 567 89</p>
                        </li>
                        <li>
                            <p><i class="fas fa-envelope pe-2 mb-0"></i>contact@example.com</p>
                        </li>
                    </ul>
                </div>
                <!--Grid column-->
            </div>
            <!--Grid row-->
        </div>
        <!-- Grid container -->

        <!-- Copyright -->
        <div class="text-center p-3 copy-right" style="background-color: rgba(0, 0, 0, 0.2)">
            © 2023 Copyright:
            <a class="text-black" href="#">Vorke.com</a>
        </div>
        <!-- Copyright -->
    </footer>

</div>
<!-- Boostrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
<!-- Slick slider -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<!-- Slick slider -->
<!-- link main.js -->
<script src="./assets/js1/lamtuan1/lamtuan1.js">
</script>
<div class="footer"></div>

<script>
    $(document).ready(function() {

        $(document).on("keyup", ".qty", function() {
            this.value = this.value.replace(/[^\d\\-]/g, ''); //not allowing any characters or symbols except minus
            this.value = this.value.replace(/\-/g, ''); //not allowing minus sign
            var pid = $(this).attr("pid");
            var qty = $(this).val();
            var price = $(".price-" + pid).text();
            var totalPrice = qty * price;
            $(".total-price-" + pid).text(totalPrice);
            totalPriceFinal()
        })


        $(document).on("click", ".minus-qty", function() {
            var pid = $(this).attr("pid");
            var qty = $(".qty-" + pid).val();
            var price = $(".price-" + pid).text();
            var totalPrice = qty * price;
            $(".total-price-" + pid).text(totalPrice);
            totalPriceFinal();
            updateQty(pid, qty, totalPrice);
        })

        function totalPriceFinal() {
            var total = $('.cart-list');
            var totalPrice = 0;
            for (var i = 0; i < total.length; i++) {
                var pid = total[i].querySelector('.total-price').getAttribute("pid");
                var price = total[i].querySelector('.total-price-' + pid).innerText;
                totalPrice += +price;
            }
            $('.total_final').html(totalPrice);
        }


        $(document).on("click", ".add-qty", function() {
            var pid = $(this).attr("pid");
            var qty = $(".qty-" + pid).val();
            var price = $(".price-" + pid).text();
            var totalPrice = qty * price;
            $(".total-price-" + pid).text(totalPrice);
            totalPriceFinal()
            updateQty(pid, qty, totalPrice);
        })

        function updateQty(pid, qtyUpdate, priceUpdate) {
            $.ajax({
                url: 'function/loadItemCart.php',
                method: 'POST',
                data: {
                    updateCart: 1,
                    updateCartId: pid,
                    qtyUpdate: qtyUpdate,
                    priceUpdate: priceUpdate,
                },
                success: function(data) {
                    console.log(data);
                }
            })
        }
        // Remove item
        $(document).on("click", ".cart-delete", function() {
            var pid = $(this).attr("pid");
            $.ajax({
                url: 'function/loadItemCart.php',
                method: "POST",
                data: {
                    removeId: pid,
                },
                success: function(data) {
                    loadCart();
                }
            })
        })

        function loadCart() {
            $.ajax({
                url: "function/loadItemCart.php",
                method: "POST",
                data: {
                    loadCart: 1
                },
                success: function(data) {
                    $(".cart-list-wrap").html(data);
                    countCart();
                }
            })
        }
        loadCart();

        function countCart() {
            $.ajax({
                url: 'function/loadItemCart.php',
                method: 'POST',
                data: {
                    cartCount: 1,
                },
                success: function(data) {
                    $(".header_name .cart_count").html(data);
                }
            });
        }
        countCart();

        $(document).on("click", ".checkout-btn", function() {
            var priceTotal = $(".total_final").text();
            $.ajax({
                url: 'function/loadItemCart.php',
                method: 'POST',
                data: {
                    checkOut: 1,
                    priceTotal: priceTotal,
                },
                success: function(data) {
                    // if (data != "Chưa đăng nhập") {
                    //     console.log(data);
                    //     alert("Đặt hàng thành công");
                    //     loadCart();
                    // } else {
                    //     alert(data);
                    //     location.href = 'login.php';
                    // }
                    if (data == 'Chưa đăng nhập') {
                        alert(data);
                        location.href = 'login.php';
                    } else {
                        if (data !== "fasle") {
                            console.log(data);
                            alert("Đặt hàng thành công");
                            loadCart();
                        } else {
                            console.log(data);
                            alert("Số lượng tồn không đủ vui lòng chọn lại số lượng!");
                            loadCart();
                        }
                    }

                }
            })
        })

    })
</script>
</body>

</html>